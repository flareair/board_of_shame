language: node_js
node_js:
  - 6.2.0

sudo: required
dist: trusty

env:
  - NODE_ENV=test

branches:
  only:
    - master
    - develop

before_install:
  # adding mongo via docker
  - docker run --name test-mongo -d -p 27017:27017 mongo
  -'openssl aes-256-cbc -K $encrypted_0a6446eb3ae3_key -iv $encrypted_0a6446eb3ae3_key -in deploy/deploy_rsa.enc -out deploy/deploy_rsa -d'
before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - 'node_modules/protractor/bin/webdriver-manager update --standalone --firefox'
  - 'node_modules/protractor/bin/webdriver-manager start 2>&1 &'
  - webpack
  - npm run server-detached
  - sleep 3

deploy:
  provider: script
  script: deploy/deploy.sh
  on:
    branch: master
